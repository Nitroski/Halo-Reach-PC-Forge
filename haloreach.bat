@echo off
color 0a
title Nitroski's Halo Reach Forge Unlocker

(for /f "usebackq tokens=1,2,*" %%a in (`reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Steam App 976730" /v InstallLocation`) do set GamePath=%%c)>nul 2>&1
echo Game path "%GamePath%" set.
:

:mainmenu
echo Pick an option:
echo 1. Unlock Forge
echo 2. Expand Forge capability (~500mb download)
echo 3. Revert changes
set /p choice=: 
if %choice%==1 goto unlock
if %choice%==2 goto expandforge
if %choice%==3 goto revert
cls
echo please pick a valid choice
goto mainmenu

:unlock
cls
echo Do you wish to backup MCC-WindowsNoEditor? (recommended)
echo 1. Yes
echo 2. No
set /p backup=: 
if %backup%==1 echo please wait... && copy "%GamePath%\MCC\Content\Paks\MCC-WindowsNoEditor.pak" "%GamePath%\MCC\Content\Paks\MCC-WindowsNoEditor.bak" >nul 2>&1
cls
echo This may take a couple minutes...
copy "%GamePath%\MCC\Content\Paks\MCC-WindowsNoEditor.pak" "%~dp0"
echo Splitting binary...
split -b 200m "MCC-WindowsNoEditor.pak" split
echo Done.
echo Hex editing binary 1/2...
call jrepl "\x00\x12\x00\x00\x00\x00\x00\x00\x00\x00\x1E\x00\x00\x00\x00\x00\x00\x00\xF6\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x95\x00\x00\x00\x00\x00\x00\x00\xEB\x00\x00\x00\x00\x00\x00\x00\x99\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x6F\x00\x00\x00\x00\x00\x00\x00\x93\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00" "\x27\x12\x00\x00\x00\x00\x00\x00\x00\x00\x1E\x00\x00\x00\x00\x00\x00\x00\xF6\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x95\x00\x00\x00\x00\x00\x00\x00\xEB\x00\x00\x00\x00\x00\x00\x00\x99\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x6F\x00\x00\x00\x00\x00\x00\x00\x93\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00" /m /x /f splitac /o -
echo 2/2...
call jrepl "\x00\x12\x00\x00\x00\x00\x00\x00\x00\x00\x15\x00\x00\x00\x00\x00\x00\x00\xF6\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x95\x00\x00\x00\x00\x00\x00\x00\xC9\x00\x00\x00\x00\x00\x00\x00\x99\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x7D\x00\x00\x00\x00\x00\x00\x00\x93\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\xF7\x00\x00\x00\x00\x00\x00\x00\x3D\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00" "\x27\x12\x00\x00\x00\x00\x00\x00\x00\x00\x15\x00\x00\x00\x00\x00\x00\x00\xF6\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x95\x00\x00\x00\x00\x00\x00\x00\xC9\x00\x00\x00\x00\x00\x00\x00\x99\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x7D\x00\x00\x00\x00\x00\x00\x00\x93\x00\x00\x00\x00\x00\x00\x00\x8F\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x36\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00\xF7\x00\x00\x00\x00\x00\x00\x00\x3D\x00\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00" /m /x /f splitac /o -
echo Done.
echo Merging split binary...
copy /b /Y splitaa + splitab + splitac + splitad + splitae + splitaf + splitag MCC-WindowsNoEditor.pak
echo Replacing binary...
copy /Y "%~dp0\MCC-WindowsNoEditor.pak" "%GamePath%\MCC\Content\Paks"
echo Cleaning up... 
del splitaa splitab splitac splitad splitae splitaf splitag MCC-WindowsNoEditor.pak
echo All done! Have fun :)
pause
msg * Remember to launch your game in Anti-Cheat Disabled mode!
exit

:expandforge
cls
echo This increases the build limit and gives access to new Forge objects. You need to unlock Forge for this to have any effect.
echo Do you wish to backup forge_halo.map? (recommended)
echo 1. Yes
echo 2. No
set /p mapbackup=: 
if %mapbackup%==1 echo please wait... && copy /Y "%GamePath%\haloreach\maps\forge_halo.map" "%GamePath%\haloreach\maps\forge_halo.bakmap" >nul 2>&1
echo Downloading modified forge_halo.map...
powershell wget https://a.gg.fm/MQlno.map -OutFile forge_halo.map
echo Done.
echo Moving map to haloreach directory...
move /Y "forge_halo.map" "%GamePath%\haloreach\maps" >nul 2>&1
echo Done.
echo Cleaning up...
del forge_halo.map
echo All done! Have fun :)
pause
msg * Remember to launch your game in Anti-Cheat Disabled mode!
exit

:revert
cls
echo This will revert all changes so you can play with Anti-Cheat enabled. This will only work if you selected the option to back up your files.
pause
echo Restoring MCC-WindowsNoEditor.pak...
move /Y "%GamePath%\MCC\Content\Paks\MCC-WindowsNoEditor.bak" "%GamePath%\MCC\Content\Paks\MCC-WindowsNoEditor.pak" >nul 2>&1
echo Done.
echo Restoring forge_halo.map...
move /Y "%GamePath%\haloreach\maps\forge_halo.bakmap" "%GamePath%\haloreach\maps\forge_halo.map" >nul 2>&1
echo All done!
pause
exit

pause